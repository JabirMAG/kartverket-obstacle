@model FirstWebApplication.Models.ObstacleData
@using System.Text.Json

<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kart</title>

    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <link rel="stylesheet" href="~/css/Map.css">
</head>
<body>
    <div class="map-wrapper">
        <div class="map-container">
            <div id="map"></div>

            <!-- Info om rapporterte hindringer --> 
            <div class="pending-info-container">
                <div class="legend-item">
                    <span class="pending-marker-example"></span>
                    <span>Rapporter under behandling</span>
                </div>
                <div class="legend-item">
                    <span class="approved-marker-example"></span>
                    <span>Godkjente rapporter</span>
                </div>
            </div>
        </div>

        <!-- Tegneknapper plassert ved siden av kartet -->
        <div class="draw-buttons-container">
            <button id="draw-point-btn" class="draw-button" title="Tegn punkt">
                Punkt
            </button>
            <button id="draw-line-btn" class="draw-button" title="Tegn linje">
                Linje
            </button>
            <button id="use-current-location" class="draw-button">
                Nåværende posisjon
            </button>
        </div>
    </div>

    <!-- Skjult felt for GeoJSON-data produsert fra kartet -->
    <input type="hidden" id="GeometryGeoJsonMap" />
    <input type="hidden" id="GeometryGeoJsonCoordinates" />

    <!-- Plassholder for hindringsskjema -->
    <div id="form-container"></div>

    <!-- Leaflet og avhengigheter -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- jQuery + valideringsskript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    <!-- Leaflet.draw-bibliotek -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

    <!-- Passer rapporterte hindringer fra server til JavaScript -->
    <script>
        @{
            var reportedObstaclesList = ViewBag.ReportedObstacles as List<FirstWebApplication.Models.ObstacleData> ?? new List<FirstWebApplication.Models.ObstacleData>();
            var reportedObstaclesJson = JsonSerializer.Serialize(reportedObstaclesList.Select(o => new {
                id = o.ObstacleId,
                name = o.ObstacleName,
                height = o.ObstacleHeight,
                description = o.ObstacleDescription,
                status = o.ObstacleStatus,
                geometryGeoJson = o.GeometryGeoJson
            }));
        }
        let reportedObstacles = @Html.Raw(reportedObstaclesJson);
    </script>

    
    <script src="~/js/map.js"></script>

</body>
</html>